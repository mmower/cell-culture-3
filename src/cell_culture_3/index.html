<!DOCTYPE html>
<html lang="en">
<head>
  <script type="text/javascript" src="../../resources/bootstrap.js"></script>
  <script type="text/javascript" src="../../resources/jquery-2.0.0.js"></script>
  <script type="text/javascript" src="../../resources/underscore.js"></script>
  <script type="text/javascript" src="../../resources/raphael.js"></script>
  <script type="text/javascript" src="../../resources/bootstrap-slider.js"></script>
  <script type="text/javascript" src="../../resources/seedrandom.js"></script>
  <link rel="stylesheet" media="all" href="../../resources/bootstrap.css">
  <link rel="stylesheet" media="all" href="../../resources/slider.css">
  <script type="text/javascript" src="cellculture.js"></script>
  <script type="text/javascript" src="gameoflife.js"></script>
  <style type="text/css">
    body {
      background-color: #FFFFFF;
    }

    .container {
      margin-left: 40px;
      margin-top: 40px;
    }
  </style>
</head>
<body>
  <div class="container">
    <form onsubmit="return false;">
    <label>Seed</label>
    <input id="seed" type="text" value="Alas Poor Yorrick">
    <label>Alive(p)</label>
    <input id="pslider" type="text" value="" data-slider-min="0.001" data-slider-max="0.999" data-slider-step="0.001" data-slider-value="0.273" data-slider-handle="triangle">
    <br>
    <label>Dimensions</label>
    <input id="dslider" type="text" value="" data-slider-min="4" data-slider-max="64" data-slider-step="1" data-slider-value="16" data-slider-handle="triangle">
    <br>
    <label>Animation delay</label>
    <input id="tslider" type="text" value="" data-slider-min="100" data-slider-max="2500" data-slider-step="100" data-slider-value="250" data-slider-handle="triangle">
    <br/>
    <button id="transport" onclick="javascript:toggleAnimation();">Play</button>
    <button id="step" onclick="javascript:stepAnimation();">Step</button>
    <button id="reset" onclick="javascript:resetAnimation();">Reset</button>
    <br/>
    </form>
    <div id="counter">Generation: </div>
    <div id="ui">
    </div>
  </div>
  <script type="text/javascript">
    var dimensions = 16;

    $(document).ready(function(){
      $("#tslider").slider().on("slideStop",function(ev){
        window.frame_interval = ev.target.value;
        if( isAnimating() ) {
          stopAnimating();
          startAnimating();
        }
      });

      $("#dslider").slider().on("slideStop",function(ev){
        dimensions = ev.target.value;
      });

      $("#pslider").slider().on("slideStop",function(ev){
        cellculture.start_alive_p = ev.target.value;
      });

      window.setupFunction = function() {
        Math.seedrandom( $("#seed").val() );
        return cellculture.setup( window.paper, dimensions, {} );
      };

      window.paper = Raphael( "ui", 600, 600 );

      window.cell_animator = window.setupFunction();
      window.animator_interval = null;
      window.frame_interval = 250;
    });

    function resetAnimation() {
      var should_start = isAnimating();

      if( should_start ) {
         stopAnimating();
      };
      window.cell_animator = window.setupFunction();
      if( should_start ) {
        startAnimating();
      }
    }

    function stepAnimation() {
      next_generation();
    }

    function isAnimating() {
      return window.animator_interval;
    }

    function stopAnimating() {
      clearInterval( window.animator_interval );
      window.animator_interval = null;
      $("#transport").html( "Play" );
    }

    function next_generation() {
      var info = window.cell_animator();
      $("#counter").html( "Generation: " + info.gen );
    }

    function startAnimating() {
      window.animator_interval = setInterval(next_generation, window.frame_interval );
      $("#transport").html( "Stop" );
    }

    function toggleAnimation() {
      if( isAnimating() ) {
        stopAnimating();
      } else {
        startAnimating();
      }
    }
  </script>
</body>
</html>

